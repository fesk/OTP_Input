(function(){OTP_Input=function(e){this.include_inline_style=!0,this.box_style="padding:0 4px 0 4px;align-content:center;width:1em;border:1px solid lavender;border-radius: 3px;",this.container_style="display: flex;font-size: 2em;",this.placeholder_style="content:attr(data-placeholder);pointer-events: none;display: block;color:lightblue;",this.placeholder="0",this.fields=6,this.focus_on_render=!0,this.attach_events=!0;let t;if(this.instance=null,e)for(let t in e)e.hasOwnProperty(t)&&(t==="include_inline_style"&&(this.include_inline_style=e[t]),t==="box_style"&&(this.box_style=e[t]),t==="container_style"&&(this.container_style=e[t]),t==="placeholder_style"&&(this.placeholder_style=e[t]),t==="fields"&&(this.fields=e[t]),t==="placeholder"&&(this.placeholder=e[t]),t==="focus_on_render"&&(this.focus_on_render=e[t]),t==="attach_events"&&(this.attach_events=e[t]),t==="no_tabindex_in_header"&&(this.no_tabindex_in_header=e[t]));this.log=function(e){console.log("TOTP_Input: "+e)},this.render=function(e,n){if(this.instance!==null){this.log("Already rendered.  Create a new instance if you want another one.");return}let o;if(n==null){if(n=["totp-enter"],!n instanceof Array){this.log("Argument 'classes' is not an array");return}n.push("totp-enter")}else n=["totp-enter"];if(e?e instanceof String?o=document.querySelector(e):o=e:(o=document.body,this.log("'parent' missing or not an element, appending to document body")),o===null)throw this.log("Parent for render is nil, or doesn't exist: "+e),"OTP_Input.render: parent nil";if(this.include_inline_style){let e=document.createElement("style");e.innerText=".totp-enter{display: flex;font-size: 2em;}.totp-char{padding:0 4px 0 4px;align-content:center;width:1em;border:1px solid lavender;border-radius: 3px;}.totp-char:empty:before{content:attr(data-placeholder);pointer-events: none;display: block;color:lightblue;}",o.appendChild(e)}let s=document.createElement("div");s.setAttribute("role","input"),s.setAttribute("aria-label","Numeric input boxes for OTP tokens of "+this.fields+" numbers.");for(let e=0;e<n.length;e++)s.classList.add(n[e]);for(let t=0;t<this.fields;t++){let e=document.createElement("div");e.classList.add("totp-char"),e.setAttribute("contenteditable",!0),e.setAttribute("data-placeholder",this.placeholder),e.setAttribute("data-val",t+1),e.setAttribute("aria-label","Number at position "+(t+1)+" of token."),s.appendChild(e)}o.appendChild(s),this.instance=s,this.focus_on_render&&s.firstElementChild.focus(),this.attach_events&&(s.addEventListener("keyup",this._progress),s.addEventListener("paste",this._onpaste)),t=this},this._progress=function(e){let n=e.target.closest(".totp-char");if(e.ctrlKey||e.metaKey)return;if(n){let s=parseInt(n.getAttribute("data-val")),o=n.closest(".totp-enter");e.keyCode>=48&&e.keyCode<=57?s===t.fields?(n.innerText=String.fromCharCode(e.keyCode),t.completed()):o.querySelector('.totp-char[data-val="'+(s+1)+'"]').focus():e.keyCode>=65&&e.keyCode<=90?n.innerText="":e.keyCode===8?s>1?(n.innerText="",o.querySelector('.totp-char[data-val="'+(s-1)+'"]').focus()):n.innerText="":e.keyCode===37?s>1&&o.querySelector('.totp-char[data-val="'+(s-1)+'"]').focus():e.keyCode===39&&s<t.fields&&o.querySelector('.totp-char[data-val="'+(s+1)+'"]').focus()}n.innerText.length>0&&(n.innerText=n.innerText[0])},this.clear=function(){let e=this.instance.querySelectorAll(".totp-char");for(let t=0;t<e.length;t++)e[t].innerText="";this.instance.firstElementChild.focus()},this.get=function(){let e=this.instance.querySelectorAll(".totp-char"),t="";for(let n=0;n<e.length;n++){let s=e[n].innerText;s&&(t+=s)}return t},this.set=function(e){if(e===null||e.length===0){this.log("Set content: nothing given, ignoring");return}if(e.length>this.fields)throw"OTP_Input.set: token given is longer than field count "+this.fields;for(let t=0;t<this.fields;t++)this.instance.querySelector('.totp-char[data-val="'+(t+1)+'"]').innerText=e[t];this.completed()},this.completed=function(){let e="";for(let t=0;t<this.fields;t++){let n=this.instance.querySelector('.totp-char[data-val="'+(t+1)+'"]').innerText;n&&(e+=n)}if(e.length===this.fields){let t=new CustomEvent("complete",{bubbles:!0,detail:{otp_token:e}});this.instance.dispatchEvent(t)}},this._onpaste=function(e){let o=e.target,s=o.closest(".totp-enter"),n=e.clipboardData.getData("text");if(n.length===1)n.charCodeAt(0)<65&&n.charCodeAt(0)>90&&e.preventDefault();else if(n.length===t.fields){for(let s=0;s<t.fields;s++){let o=n.charCodeAt(s);if(o<65&&o>90){e.preventDefault();return}}for(let e=1;e<t.fields+1;e++)s.querySelector('.totp-char[data-val="'+e+'"]').innerText=n[e-1];e.preventDefault(),s.querySelector('.totp-char[data-val="'+t.fields+'"]').focus(),t.completed()}else e.preventDefault()}}})()
